<!-- Loading Screen or App Content -->
@if (isLoading()) {
<!-- Loading Screen -->
<div class="relative font-sans w-[390px] h-[844px] bg-slate-100 rounded-[60px] shadow-2xl overflow-hidden ring-4 ring-slate-800">
  <div class="flex flex-col items-center justify-center h-full">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-24 h-24 text-blue-600 mb-8">
      <path fill-rule="evenodd" d="M12.5,4A1.5,1.5,0,0,1,14,5.5V6.88A3.49,3.49,0,0,1,17.5,10.25V11A1.5,1.5,0,0,1,16,12.5H8A1.5,1.5,0,0,1,6.5,11V10.25A3.49,3.49,0,0,1,10,6.88V5.5A1.5,1.5,0,0,1,11.5,4h1M19.5,8A1.5,1.5,0,0,0,18,9.5V11a1.5,1.5,0,0,0,1.5,1.5h1A1.5,1.5,0,0,0,22,11V9.5A1.5,1.5,0,0,0,20.5,8h-1M3.5,8A1.5,1.5,0,0,0,2,9.5V11a1.5,1.5,0,0,0,1.5,1.5h1A1.5,1.5,0,0,0,6,11V9.5A1.5,1.5,0,0,0,4.5,8h-1m8,4.5A1.5,1.5,0,0,0,10,14v1.5A1.5,1.5,0,0,0,11.5,17h1A1.5,1.5,0,0,0,14,15.5V14a1.5,1.5,0,0,0-1.5-1.5h-1Z" clip-rule="evenodd" />
    </svg>
    <div class="w-12 h-12 border-4 border-slate-300 border-t-blue-600 rounded-full animate-spin"></div>
  </div>
</div>
} @else {
<!-- Mobile Phone Frame -->
<div class="relative font-sans w-[390px] h-[844px] bg-slate-100 rounded-[60px] shadow-2xl overflow-hidden ring-4 ring-slate-800">
  <div class="absolute inset-0 flex flex-col">
    <!-- Header with Pet Selector -->
    <header class="relative flex-shrink-0 bg-slate-100/80 backdrop-blur-lg z-10 px-6 pt-12 pb-4">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center space-x-3">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-8 h-8 text-blue-600">
            <path fill-rule="evenodd" d="M12.5,4A1.5,1.5,0,0,1,14,5.5V6.88A3.49,3.49,0,0,1,17.5,10.25V11A1.5,1.5,0,0,1,16,12.5H8A1.5,1.5,0,0,1,6.5,11V10.25A3.49,3.49,0,0,1,10,6.88V5.5A1.5,1.5,0,0,1,11.5,4h1M19.5,8A1.5,1.5,0,0,0,18,9.5V11a1.5,1.5,0,0,0,1.5,1.5h1A1.5,1.5,0,0,0,22,11V9.5A1.5,1.5,0,0,0,20.5,8h-1M3.5,8A1.5,1.5,0,0,0,2,9.5V11a1.5,1.5,0,0,0,1.5,1.5h1A1.5,1.5,0,0,0,6,11V9.5A1.5,1.5,0,0,0,4.5,8h-1m8,4.5A1.5,1.5,0,0,0,10,14v1.5A1.5,1.5,0,0,0,11.5,17h1A1.5,1.5,0,0,0,14,15.5V14a1.5,1.5,0,0,0-1.5-1.5h-1Z" clip-rule="evenodd" />
          </svg>
          <h1 class="text-2xl font-bold text-slate-800">Mi Mascota</h1>
        </div>
      </div>
      <div class="pet-selector flex items-center gap-4 py-2 -mx-6 px-6 overflow-x-auto">
        @for(pet of pets(); track pet.id) {
        <button (click)="selectPetById(pet.id)" class="flex-shrink-0 text-center space-y-1 focus:outline-none">
          <img [src]="pet.photoUrl" width="56" height="56" [alt]="pet.name" class="rounded-full transition-all duration-200" [class]="pet.id === selectedPetId() ? 'ring-4 ring-blue-500 p-0.5' : 'ring-2 ring-transparent'">
          <span class="text-xs font-medium" [class]="pet.id === selectedPetId() ? 'text-blue-600' : 'text-slate-600'">{{pet.name}}</span>
        </button>
        }
        <button (click)="openAddPetModal()" class="flex-shrink-0 w-14 h-14 bg-slate-200 text-slate-500 rounded-full flex items-center justify-center hover:bg-slate-300 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
            <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
          </svg>
        </button>
      </div>
    </header>

    <!-- App Content (Scrollable) -->
    <main class="flex-grow overflow-y-auto app-content p-6 space-y-6">
      @if (selectedPet(); as pet) {
      <!-- Pet Profile Card -->
      <section class="bg-white rounded-2xl shadow-lg p-6 flex flex-col items-center text-center">
        <div class="relative mb-4">
          <img [src]="pet.photoUrl" width="120" height="120" alt="Foto de {{ pet.name }}" class="rounded-full border-4 border-blue-200 object-cover">
          <button (click)="openEditPetModal()" class="absolute bottom-0 right-0 text-white bg-blue-600 p-2 rounded-full hover:bg-blue-700 transition-colors shadow-md">
            <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path d="m5.433 13.917 1.262-3.155A4 4 0 0 1 7.58 9.42l6.92-6.918a2.121 2.121 0 0 1 3 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 0 1-.65-.65Z" />
              <path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0 0 10 3H4.75A2.75 2.75 0 0 0 2 5.75v9.5A2.75 2.75 0 0 0 4.75 18h9.5A2.75 2.75 0 0 0 17 15.25V10a.75.75 0 0 0-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5Z" />
            </svg>
          </button>
        </div>
        <h2 class="text-3xl font-bold text-slate-900">{{ pet.name }}</h2>
        <p class="text-slate-600 text-lg">{{ pet.breed }}</p>
        <p class="text-slate-500">{{ petAge() }} años</p>
      </section>

      <!-- Vet Clinic Info -->
      <section class="bg-white rounded-2xl shadow-lg p-6">
        <h3 class="text-sm font-semibold text-slate-500 mb-3 uppercase tracking-wider">Clínica Veterinaria</h3>
        <div class="space-y-3">
          <div class="flex items-center">
            <svg class="w-5 h-5 text-slate-500 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 21v-8.25M15.75 21v-8.25M8.25 21v-8.25M3 9l9-6 9 6m-1.5 12V10.332A48.36 48.36 0 0 0 12 9.75c-2.551 0-5.056.2-7.5.582V21M3 21h18M12 6.75h.008v.008H12V6.75Z" /></svg>
            <span class="text-slate-700">{{ vetClinic().name }}</span>
          </div>
          <div class="flex items-center">
            <svg class="w-5 h-5 text-slate-500 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" /></svg>
            <span class="text-slate-700">{{ vetClinic().hours }}</span>
          </div>
          <div class="flex items-center">
            <svg class="w-5 h-5 text-slate-500 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 6.75c0 8.284 6.716 15 15 15h2.25a2.25 2.25 0 0 0 2.25-2.25v-1.372c0-.516-.351-.966-.852-1.091l-4.423-1.106c-.44-.11-.902.055-1.173.417l-.97 1.293c-.282.376-.769.542-1.21.38a12.035 12.035 0 0 1-7.143-7.143c-.162-.441.004-.928.38-1.21l1.293-.97c.363-.271.527-.734.417-1.173L6.963 3.102a1.125 1.125 0 0 0-1.091-.852H4.5A2.25 2.25 0 0 0 2.25 6.75Z" /></svg>
            <a href="tel:{{ vetClinic().phone }}" class="text-blue-600 hover:underline">{{ vetClinic().phone }}</a>
          </div>
        </div>
      </section>

      <!-- Food Info -->
      <section>
        <div class="flex justify-between items-center mb-3">
          <h3 class="text-sm font-semibold text-slate-500 uppercase tracking-wider">Alimento</h3>
          <button (click)="openAddFoodModal()" class="w-8 h-8 bg-slate-200 text-slate-500 rounded-lg flex items-center justify-center hover:bg-slate-300 transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
              <path d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z" />
            </svg>
          </button>
        </div>
        @if (selectedPetFood().length > 0) {
        <div class="space-y-3">
          @for (food of selectedPetFood(); track food.id) {
          <div class="bg-white rounded-2xl shadow-lg p-4 flex items-center gap-4">
            <img [src]="food.photoUrl" width="64" height="64" [alt]="food.name" class="rounded-lg object-cover w-16 h-16 flex-shrink-0">
            <div class="flex-grow">
              <p class="font-bold text-slate-800">{{ food.name }}</p>
              <p class="text-sm text-slate-500">{{ food.weightKg }} kg</p>
            </div>
            <button (click)="openEditFoodModal(food)" class="text-slate-400 hover:text-blue-600 p-2 rounded-full hover:bg-slate-100 transition-colors flex-shrink-0">
              <svg class="w-5 h-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                <path d="m5.433 13.917 1.262-3.155A4 4 0 0 1 7.58 9.42l6.92-6.918a2.121 2.121 0 0 1 3 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 0 1-.65-.65Z" />
                <path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0 0 10 3H4.75A2.75 2.75 0 0 0 2 5.75v9.5A2.75 2.75 0 0 0 4.75 18h9.5A2.75 2.75 0 0 0 17 15.25V10a.75.75 0 0 0-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5Z" />
              </svg>
            </button>
          </div>
          }
        </div>
        } @else {
        <div class="bg-white rounded-2xl shadow-lg p-6 text-center text-slate-500">
          <p>No hay alimentos registrados.</p>
        </div>
        }
      </section>

      <!-- Upcoming Controls -->
      <section>
        <h3 class="text-sm font-semibold text-slate-500 mb-3 uppercase tracking-wider">Próximos Controles</h3>
        @if (upcomingControls().length > 0) {
        <div class="space-y-3">
          @for (record of upcomingControls(); track record.id) {
          <div [class]="'bg-white rounded-2xl shadow-lg p-4 border-l-4 ' + (record.type === 'Próximo Control' ? 'border-purple-500' : 'border-pink-500')">
            <div class="flex justify-between items-start">
              <div>
                <p class="font-bold text-slate-800">{{ record.notes }}</p>
                <p class="text-sm text-slate-500">Dr(a). {{ record.doctor }}</p>
              </div>
              <div class="flex items-center gap-2">
                <div class="text-right">
                    <p [class]="'text-sm font-semibold ' + (record.type === 'Próximo Control' ? 'text-purple-700' : 'text-pink-700')">{{ record.date | date:'dd MMM yyyy' }}</p>
                    @if(record.time) {
                        <p class="text-xs text-slate-500 flex items-center justify-end gap-1">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="currentColor" class="w-3 h-3"><path fill-rule="evenodd" d="M8 1.75a.75.75 0 0 1 .75.75v5.5c0 .414-.336.75-.75.75h-3.5a.75.75 0 0 1 0-1.5h2.75V2.5A.75.75 0 0 1 8 1.75Z" clip-rule="evenodd" /></svg>
                            {{ record.time }}
                        </p>
                    }
                </div>
                <button (click)="openEditRecordModal(record)" class="text-slate-400 hover:text-blue-600 p-1 rounded-full hover:bg-slate-100 transition-colors">
                  <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path d="m5.433 13.917 1.262-3.155A4 4 0 0 1 7.58 9.42l6.92-6.918a2.121 2.121 0 0 1 3 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 0 1-.65-.65Z" />
                    <path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0 0 10 3H4.75A2.75 2.75 0 0 0 2 5.75v9.5A2.75 2.75 0 0 0 4.75 18h9.5A2.75 2.75 0 0 0 17 15.25V10a.75.75 0 0 0-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5Z" />
                  </svg>
                </button>
              </div>
            </div>
          </div>
          }
        </div>
        } @else {
        <div class="bg-white rounded-2xl shadow-lg p-6 text-center text-slate-500">
          <p>No hay controles programados.</p>
        </div>
        }
      </section>

      <!-- Vaccination Schedule -->
      <section>
        <h3 class="text-sm font-semibold text-slate-500 mb-3 uppercase tracking-wider">Calendario de Vacunación</h3>
        @if (vaccinationSchedule().length > 0) {
        <div class="space-y-3">
            @for (record of vaccinationSchedule(); track record.id) {
            <div class="bg-white rounded-2xl shadow-lg p-4 border-l-4 border-green-500">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="font-bold text-slate-800">{{ record.notes }}</p>
                        <p class="text-sm text-slate-500">Aplicada: {{ record.date | date:'dd MMM yyyy' }}</p>
                    </div>
                    <div class="flex items-center gap-2">
                        @if (record.nextDueDate) {
                            <div class="text-right">
                                <p class="text-sm font-semibold text-green-700">Próxima Dosis</p>
                                <p class="text-xs text-slate-500">{{ record.nextDueDate | date:'dd MMM yyyy' }}</p>
                            </div>
                        }
                        <button (click)="openEditRecordModal(record)" class="text-slate-400 hover:text-blue-600 p-1 rounded-full hover:bg-slate-100 transition-colors">
                            <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path d="m5.433 13.917 1.262-3.155A4 4 0 0 1 7.58 9.42l6.92-6.918a2.121 2.121 0 0 1 3 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 0 1-.65-.65Z" /><path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0 0 10 3H4.75A2.75 2.75 0 0 0 2 5.75v9.5A2.75 2.75 0 0 0 4.75 18h9.5A2.75 2.75 0 0 0 17 15.25V10a.75.75 0 0 0-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5Z" /></svg>
                        </button>
                    </div>
                </div>
            </div>
            }
        </div>
        } @else {
        <div class="bg-white rounded-2xl shadow-lg p-6 text-center text-slate-500">
            <p>No hay vacunas registradas.</p>
        </div>
        }
      </section>

      <!-- Medical History -->
      <section>
        <h3 class="text-sm font-semibold text-slate-500 mb-3 uppercase tracking-wider">Historial Médico</h3>
        
        <!-- Filters -->
        <div class="bg-white rounded-2xl shadow-lg p-4 mb-4">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="filter-start-date" class="block text-xs font-medium text-slate-600 mb-1">Desde</label>
                    <input type="date" id="filter-start-date" name="filter-start-date" [(ngModel)]="filterStartDate" class="block w-full text-sm border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md">
                </div>
                <div>
                    <label for="filter-end-date" class="block text-xs font-medium text-slate-600 mb-1">Hasta</label>
                    <input type="date" id="filter-end-date" name="filter-end-date" [(ngModel)]="filterEndDate" class="block w-full text-sm border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 rounded-md">
                </div>
            </div>
            <div class="flex gap-2 mt-3 text-xs flex-wrap">
                <button (click)="setFilterType('Control')" [class]="'px-3 py-1 rounded-full transition-colors ' + (filterType() === 'Control' ? 'bg-blue-600 text-white' : 'bg-slate-200 text-slate-700')">Control</button>
                <button (click)="setFilterType('Vacuna')" [class]="'px-3 py-1 rounded-full transition-colors ' + (filterType() === 'Vacuna' ? 'bg-blue-600 text-white' : 'bg-slate-200 text-slate-700')">Vacuna</button>
                <button (click)="setFilterType('Medicación')" [class]="'px-3 py-1 rounded-full transition-colors ' + (filterType() === 'Medicación' ? 'bg-blue-600 text-white' : 'bg-slate-200 text-slate-700')">Medicación</button>
                <button (click)="setFilterType('Recordatorio Medicación')" [class]="'px-3 py-1 rounded-full transition-colors ' + (filterType() === 'Recordatorio Medicación' ? 'bg-blue-600 text-white' : 'bg-slate-200 text-slate-700')">Recordatorio</button>
                <button (click)="clearFilters()" class="ml-auto text-slate-500 hover:text-blue-600 font-semibold">Limpiar</button>
            </div>
        </div>

        @if (pastRecords().length > 0) {
        <div class="space-y-3">
          @for (record of pastRecords(); track record.id) {
          <div class="bg-white rounded-2xl shadow-lg p-4">
            <div class="flex justify-between items-center mb-2">
              <span [class]="'inline-flex items-center gap-1.5 px-3 py-1 text-xs font-semibold rounded-full ' + getRecordTypeClass(record.type)">
                @switch (record.type) {
                  @case ('Control') {
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 text-blue-800">
                        <path d="M12.001 2.25A2.25 2.25 0 009.75 4.5v1.132a13.53 13.53 0 00-2.038.531 3 3 0 00-1.897 2.585 1.5 1.5 0 001.321 1.745 13.43 13.43 0 002.316.374c.24.01.48.022.722.036V12a2.25 2.25 0 004.5 0v-.628c.242-.014.482-.026.722-.036a13.433 13.433 0 002.316-.374 1.5 1.5 0 001.321-1.745 3 3 0 00-1.897-2.585A13.53 13.53 0 0014.25 5.632V4.5a2.25 2.25 0 00-2.25-2.25h-.001z" />
                        <path d="M12 12.75a6 6 0 00-6 6v.75a.75.75 0 00.75.75h10.5a.75.75 0 00.75-.75V18.75a6 6 0 00-6-6z" />
                    </svg>
                  }
                  @case ('Vacuna') {
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
                  </svg>
                  }
                  @case ('Medicación') {
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-4 h-4">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9.75 3.104v5.714a2.25 2.25 0 0 1-.659 1.591L5 14.5M9.75 3.104c.102.046.206.086.314.122s.21.071.318.101M9.75 3.104c.162.08.32.162.472.246s.3.17.442.258m6.29 6.355c-.892.892-2.04 1.34-3.174 1.34-1.134 0-2.282-.448-3.174-1.34m0-3.174c.892-.892 2.04-1.34 3.174-1.34 1.134 0 2.282.448 3.174 1.34m0 3.174-3.174 3.174m3.174-3.174 3.174-3.174" />
                  </svg>
                  }
                  @case ('Recordatorio Medicación') {
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 text-pink-800">
                      <path d="M10 2a6 6 0 00-6 6v3.586l-1.707 1.707A1 1 0 003 15h14a1 1 0 00.707-1.707L16 11.586V8a6 6 0 00-6-6zM10 18a3 3 0 01-3-3h6a3 3 0 01-3 3z" />
                    </svg>
                  }
                }
                <span>{{ record.type }}</span>
              </span>
              <div class="flex items-center gap-2">
                <span class="text-sm text-slate-500">{{ record.date | date:'dd MMM yyyy' }}</span>
                <button (click)="openEditRecordModal(record)" class="text-slate-400 hover:text-blue-600 p-1 rounded-full hover:bg-slate-100 transition-colors">
                  <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                    <path d="m5.433 13.917 1.262-3.155A4 4 0 0 1 7.58 9.42l6.92-6.918a2.121 2.121 0 0 1 3 3l-6.92 6.918c-.383.383-.84.685-1.343.886l-3.154 1.262a.5.5 0 0 1-.65-.65Z" />
                    <path d="M3.5 5.75c0-.69.56-1.25 1.25-1.25H10A.75.75 0 0 0 10 3H4.75A2.75 2.75 0 0 0 2 5.75v9.5A2.75 2.75 0 0 0 4.75 18h9.5A2.75 2.75 0 0 0 17 15.25V10a.75.75 0 0 0-1.5 0v5.25c0 .69-.56 1.25-1.25 1.25h-9.5c-.69 0-1.25-.56-1.25-1.25v-9.5Z" />
                  </svg>
                </button>
              </div>
            </div>
            <p class="text-slate-700">{{ record.notes }}</p>
            <p class="text-sm text-slate-500 mt-1">Atendido por Dr(a). {{ record.doctor }}</p>
          </div>
          }
        </div>
        } @else {
        <div class="bg-white rounded-2xl shadow-lg p-6 text-center text-slate-500">
          <p>No hay registros que coincidan con los filtros.</p>
        </div>
        }
      </section>
      } @else {
      <div class="bg-white rounded-2xl shadow-lg p-10 text-center">
        <h2 class="text-2xl font-bold text-slate-700 mb-2">¡Bienvenido!</h2>
        <p class="text-slate-500 mb-6">Parece que no tienes ninguna mascota registrada. <br> ¡Añade una para empezar!</p>
        <button (click)="openAddPetModal()" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
          Añadir mi primera mascota
        </button>
      </div>
      }
    </main>
  </div>

  <!-- Add Record FAB -->
  @if (selectedPet()) {
  <button (click)="openAddRecordModal()" class="absolute bottom-6 right-6 bg-blue-600 text-white rounded-full p-4 shadow-xl hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-transform duration-200 hover:scale-110 z-20">
    <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
    </svg>
  </button>
  }

  <!-- Add/Edit Record Modal -->
  @if (showRecordModal()) {
  <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" (click)="showRecordModal.set(false)">
    <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm m-4" (click)="$event.stopPropagation()">
      <h3 class="text-2xl font-bold text-slate-800 mb-4">
        @if (editingRecordId() === null) {
        Añadir Registro
        } @else {
        Editar Registro
        }
      </h3>
      <form (ngSubmit)="saveRecord()" class="space-y-4">
        <div>
          <label for="type" class="block text-sm font-medium text-slate-700">Tipo de Registro</label>
          <select id="type" name="type" [(ngModel)]="newRecord().type" class="mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
            @for(type of recordTypes; track type) {
            <option [value]="type">{{ type }}</option>
            }
          </select>
        </div>
        <div>
          <label for="date" class="block text-sm font-medium text-slate-700">Fecha</label>
          <input type="date" id="date" name="date" [(ngModel)]="newRecord().date" class="mt-1 block w-full pl-3 pr-2 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
        </div>
        @if (newRecord().type === 'Próximo Control' || newRecord().type === 'Recordatorio Medicación') {
          <div>
            <label for="time" class="block text-sm font-medium text-slate-700">Hora</label>
            <input type="time" id="time" name="time" [(ngModel)]="newRecord().time" class="mt-1 block w-full pl-3 pr-2 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
          </div>
        }
        @if (newRecord().type === 'Vacuna') {
          <div>
            <label for="nextDueDate" class="block text-sm font-medium text-slate-700">Próxima Dosis</label>
            <input type="date" id="nextDueDate" name="nextDueDate" [(ngModel)]="newRecord().nextDueDate" class="mt-1 block w-full pl-3 pr-2 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
          </div>
        }
        <div>
          <label for="doctor" class="block text-sm font-medium text-slate-700">Doctor</label>
          <input type="text" id="doctor" name="doctor" [(ngModel)]="newRecord().doctor" placeholder="Dr. Smith" class="mt-1 block w-full pl-3 pr-2 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
        </div>
        <div>
          <label for="notes" class="block text-sm font-medium text-slate-700">Notas</label>
          <textarea id="notes" name="notes" rows="3" [(ngModel)]="newRecord().notes" [placeholder]="newRecord().type === 'Vacuna' ? 'Nombre de la vacuna...' : 'Detalles del control...'" class="mt-1 block w-full pl-3 pr-2 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md"></textarea>
        </div>
        <div class="flex justify-end space-x-3 pt-2">
          <button type="button" (click)="showRecordModal.set(false)" class="bg-slate-200 text-slate-800 px-4 py-2 rounded-lg hover:bg-slate-300 transition-colors">Cancelar</button>
          <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">Guardar</button>
        </div>
      </form>
    </div>
  </div>
  }

  <!-- Add/Edit Pet Modal -->
  @if (showPetModal()) {
  <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" (click)="showPetModal.set(false)">
    <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm m-4" (click)="$event.stopPropagation()">
      <h3 class="text-2xl font-bold text-slate-800 mb-4">
        @if (editingPetId() === null) {
        Añadir Mascota
        } @else {
        Editar Mascota
        }
      </h3>
      <form (ngSubmit)="savePet()" class="space-y-4">
        <div class="flex flex-col items-center">
          <img [src]="petFormModel().photoUrl" alt="Vista previa de la mascota" class="w-24 h-24 rounded-full object-cover mb-4 border-4 border-slate-200">
          <div class="flex gap-2">
            <button type="button" (click)="fileInput.click()" class="text-sm bg-slate-200 text-slate-800 px-3 py-2 rounded-md hover:bg-slate-300 transition-colors font-semibold">Subir Foto</button>
            <button type="button" (click)="cameraInput.click()" class="text-sm bg-slate-200 text-slate-800 px-3 py-2 rounded-md hover:bg-slate-300 transition-colors font-semibold">Tomar Foto</button>
            <input #fileInput type="file" class="hidden" accept="image/*" (change)="onPhotoSelected($event)">
            <input #cameraInput type="file" class="hidden" accept="image/*" capture="user" (change)="onPhotoSelected($event)">
          </div>
        </div>
        <div>
          <label for="pet-name" class="block text-sm font-medium text-slate-700">Nombre</label>
          <input type="text" id="pet-name" name="pet-name" [(ngModel)]="petFormModel().name" placeholder="Buddy" class="mt-1 block w-full pl-3 pr-2 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
        </div>
        <div>
          <label for="pet-breed" class="block text-sm font-medium text-slate-700">Raza</label>
          <input type="text" id="pet-breed" name="pet-breed" [(ngModel)]="petFormModel().breed" placeholder="Golden Retriever" class="mt-1 block w-full pl-3 pr-2 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
        </div>
        <div>
          <label for="pet-dob" class="block text-sm font-medium text-slate-700">Fecha de Nacimiento</label>
          <input type="date" id="pet-dob" name="pet-dob" [(ngModel)]="petFormModel().dob" class="mt-1 block w-full pl-3 pr-2 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
        </div>
        
        <div class="flex justify-between items-center pt-2">
          <div>
            @if (editingPetId() !== null) {
            <button type="button" (click)="deletePet()" class="text-red-600 hover:text-red-800 text-sm font-semibold">Eliminar Mascota</button>
            }
          </div>
          <div class="flex space-x-3">
            <button type="button" (click)="showPetModal.set(false)" class="bg-slate-200 text-slate-800 px-4 py-2 rounded-lg hover:bg-slate-300 transition-colors">Cancelar</button>
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">Guardar</button>
          </div>
        </div>
      </form>
    </div>
  </div>
  }

  <!-- Add/Edit Food Modal -->
  @if (showFoodModal()) {
  <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" (click)="showFoodModal.set(false)">
    <div class="bg-white rounded-2xl shadow-2xl p-6 w-full max-w-sm m-4" (click)="$event.stopPropagation()">
      <h3 class="text-2xl font-bold text-slate-800 mb-4">
        @if (editingFoodId() === null) {
        Añadir Alimento
        } @else {
        Editar Alimento
        }
      </h3>
      <form (ngSubmit)="saveFood()" class="space-y-4">
        <div class="flex flex-col items-center">
          <img [src]="foodFormModel().photoUrl" alt="Vista previa del alimento" class="w-24 h-24 rounded-lg object-cover mb-4 border-4 border-slate-200">
          <div class="flex gap-2">
            <button type="button" (click)="foodFileInput.click()" class="text-sm bg-slate-200 text-slate-800 px-3 py-2 rounded-md hover:bg-slate-300 transition-colors font-semibold">Subir Foto</button>
            <button type="button" (click)="foodCameraInput.click()" class="text-sm bg-slate-200 text-slate-800 px-3 py-2 rounded-md hover:bg-slate-300 transition-colors font-semibold">Tomar Foto</button>
            <input #foodFileInput type="file" class="hidden" accept="image/*" (change)="onFoodPhotoSelected($event)">
            <input #foodCameraInput type="file" class="hidden" accept="image/*" capture="user" (change)="onFoodPhotoSelected($event)">
          </div>
        </div>
        <div>
          <label for="food-name" class="block text-sm font-medium text-slate-700">Nombre del Alimento</label>
          <input type="text" id="food-name" name="food-name" [(ngModel)]="foodFormModel().name" placeholder="Ej: Royal Canin" class="mt-1 block w-full pl-3 pr-2 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
        </div>
        <div>
          <label for="food-weight" class="block text-sm font-medium text-slate-700">Kilos</label>
          <input type="number" id="food-weight" name="food-weight" [(ngModel)]="foodFormModel().weightKg" placeholder="12" step="0.1" min="0" class="mt-1 block w-full pl-3 pr-2 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md">
        </div>
        
        <div class="flex justify-between items-center pt-2">
          <div>
            @if (editingFoodId() !== null) {
            <button type="button" (click)="deleteFood()" class="text-red-600 hover:text-red-800 text-sm font-semibold">Eliminar</button>
            }
          </div>
          <div class="flex space-x-3">
            <button type="button" (click)="showFoodModal.set(false)" class="bg-slate-200 text-slate-800 px-4 py-2 rounded-lg hover:bg-slate-300 transition-colors">Cancelar</button>
            <button type="submit" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors">Guardar</button>
          </div>
        </div>
      </form>
    </div>
  </div>
  }
</div>
}